<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:p="http://primefaces.org/ui"
      xmlns:f="http://xmlns.jcp.org/jsf/core"
      xmlns:piw="http://xmlns.jcp.org/jsf/composite/ezcomp"
      xmlns:addDialog="http://xmlns.jcp.org/jsf/composite/ezcomp"
      xmlns:tm="http://xmlns.jcp.org/jsf/composite/ezcomp">
    <h:head>
        <link rel="shortcut icon" type="image/png" href="#{request.contextPath}/resources/images/favicon.ico" />
        <title>WP Maps</title>
        <h:outputStylesheet library="css" name="pf_template.css" />
        <script src = "http://maps.google.com/maps/api/js?key=AIzaSyDzwk44zfDh3JQSN1ooK-SIXzvODeFo_dc"
                type = "text/javascript" />
                
        <style>
            table {
                font-family: arial, sans-serif;
                border-collapse: collapse;
                width: 100%;
                
            }

            td, th {
                border: 1px solid #dddddd;
                text-align: left;
                padding: 8px;
                width: 30px;
            }
            
        </style>
    </h:head>
    <h:body>
    <h:form id="form" prependId="false">
        
        <p:growl id="messages" showDetail="true"  sticky="true" />
        <p:gmap id ="gmap" center="46.9422145,31.9990089" zoom="#{gMapsController.zoomMap}" type="terrain" model="#{gMapsController.model}"                 
                style="width: 100vw;height: 100vh;" onPointClick="handlePointClick(event);" widgetVar="map" fitBounds="false">
            
            <p:ajax event="overlaySelect" listener="#{gMapsController.onMarkerSelect}" />            
            <!--
            <p:ajax event="stateChange" listener="#{gMapsController.onStateChange}" />
            -->
            <!--
            <p:gmapInfoWindow id="infoWindow" maxWidth="300">
                <piw:panelInfowindow/>
            </p:gmapInfoWindow>  
            -->
        </p:gmap>

        <tm:topMenu/>
        
        <p:panel id="button_panel" styleClass="legendPanel" visible="false" widgetVar="testPanel" closable="true" toggleable="true" >
            <p:graphicImage height="130" width="130" value="../resources/marker/legend.png" />
        </p:panel>
<!--            
        <p:dialog header="Pillar info" widgetVar="dlg1" modal="false" height="300" width="800">
            <p:dataTable var="pillar" value="{gMapsController.list}">
                    <p:column headerText="Id">
                        <h:outputText value="{pillar.id}" />
                    </p:column>

                    <p:column headerText="Station">
                        <h:outputText value="{pillar.transportstation}" />
                    </p:column>

                    <p:column headerText="Number">
                        <h:outputText value="{pillar.numbertranspotrstation}" />
                    </p:column>

                    <p:column headerText="Owner">
                        <h:outputText value="{pillar.owner}" />
                    </p:column>

                    <p:column headerText="Type">
                        <h:outputText value="{pillar.type}" />
                    </p:column>

                    <p:column headerText="Matherial">
                        <h:outputText value="{pillar.matheriallPillar}" />
                    </p:column>
                </p:dataTable>
        </p:dialog>
-->        
<!--
        <p:dialog header="Detail pillar info" widgetVar="dlg2" modal="true" height="300" width="800" >
            <h:panelGrid columns="1" >
                <p:row>
                    <p:column>Столб</p:column>
                </p:row>
            </h:panelGrid>
            <h:panelGrid columns="2"  >
                <p:row>
                    <p:column>Транспортная подстанция </p:column>
                </p:row>
                <p:row>
                    <p:outputLabel value="{gMapsController.selectedPillar.id}" />
                </p:row>
                <p:row>
                    <p:column>Номер подстанции </p:column>
                </p:row>
                <p:row>
                    <p:outputLabel  value="{gMapsController.selectedPillar.numbertranspotrstation}"/>
                </p:row>        
                <p:row>
                    <p:column>Балансодержатель </p:column>
                </p:row>
                <p:row>
                    <p:outputLabel value="{gMapsController.selectedPillar.owner.ownerType}" />
                </p:row>
                <p:row>
                    <p:column>Материал </p:column>
                </p:row>
                <p:row>
                    <p:outputLabel  value="{gMapsController.selectedPillar.matheriallPillar.pillarMaterial}"/>
                </p:row>    
                <p:row>
                    <p:column>Тип столба</p:column>
                </p:row> 
                <p:row>
                    <p:outputLabel value="{gMapsController.selectedPillar.type.pilarType}" />
                </p:row>  
            </h:panelGrid>
            <h:panelGrid columns="1" >
                <p:row>
                    <p:column>Муфта</p:column>
                </p:row>
            </h:panelGrid>
            <h:panelGrid columns="2" >               
                <p:row>
                    <p:column>Количество касет </p:column>
                </p:row>                    
                <p:row>
                    <p:outputLabel  value="48(1), 8(3), 96(1)"/>
                </p:row>    
                <p:row>
                    <p:column>К-во кабелей + ёмкости </p:column>
                </p:row> 
                <p:row>
                    <p:outputLabel value="{gMapsController.selectedPillar.clutchId.countcassets}" />
                </p:row>
                <p:row>
                    <p:column>Вводы </p:column>
                </p:row>                    
                <p:row>
                    <p:outputLabel  value="{gMapsController.selectedPillar.clutchId.inputs}"/>
                </p:row>    
                <p:row>
                    <p:column>Инфо </p:column>
                </p:row> 
                <p:row>
                    <p:outputLabel value="{gMapsController.selectedPillar.clutchId.info}" />
                </p:row>                      
            </h:panelGrid>
            <h:panelGrid columns="1" >
                <p:row>
                    <p:column>Кабель</p:column>
                </p:row>
            </h:panelGrid>
            <h:panelGrid columns="2" >               
                <p:row>
                    <p:column>Производитель </p:column>
                </p:row>                    
                <p:row>
                    <p:outputLabel  value="{gMapsController.selectedPillar.cabelId.production}"/>
                </p:row>    
                <p:row>
                    <p:column>Ёмкость </p:column>
                </p:row> 
                <p:row>
                    <p:outputLabel value="{gMapsController.selectedPillar.cabelId.capacity}" />
                </p:row>
                <p:row>
                    <p:column>К-во модулей </p:column>
                </p:row>                    
                <p:row>
                    <p:outputLabel  value="{gMapsController.selectedPillar.matheriallPillar.pillarMaterial}"/>
                </p:row>    
                <p:row>
                    <p:column>Адрес приходящий </p:column>
                </p:row> 
                <p:row>
                    <p:outputLabel value="{gMapsController.selectedPillar.type.pilarType}" />
                </p:row> 
                <p:row>
                    <p:column>Адрес Муфты куда заведен</p:column>
                </p:row> 
                <p:row>
                    <p:outputLabel value="{gMapsController.selectedPillar.type.pilarType}" />
                </p:row>
                <p:row>
                    <p:column>Метраж кабеля от точки к точке(м)</p:column>
                </p:row> 
                <p:row>
                    <p:outputLabel value="{gMapsController.selectedPillar.type.pilarType}" />
                </p:row>                           
            </h:panelGrid> 
            <h:panelGrid columns="1" >
                <p:row>
                    <p:column>Волокно</p:column>
                </p:row>
            </h:panelGrid>
            <h:panelGrid columns="2" >               
                <p:row>
                    <p:column>№ волокна </p:column>
                </p:row>                    
                <p:row>
                    <p:outputLabel  value="{gMapsController.selectedPillar.matheriallPillar.pillarMaterial}"/>
                </p:row>    
                <p:row>
                    <p:column>Адрес владельца </p:column>
                </p:row> 
                <p:row>
                    <p:outputLabel value="{gMapsController.selectedPillar.type.pilarType}" />
                </p:row>
                <p:row>
                    <p:column>Тип волокна </p:column>
                </p:row>                    
                <p:row>
                    <p:outputLabel  value="{gMapsController.selectedPillar.matheriallPillar.pillarMaterial}"/>
                </p:row>    
                <p:row>
                    <p:column>Куда кабель вварено </p:column>
                </p:row> 
                <p:row>
                    <p:outputLabel value="{gMapsController.selectedPillar.type.pilarType}" />
                </p:row> 
                <p:row>
                    <p:column>№ волокна уходящего кабеля</p:column>
                </p:row> 
                <p:row>
                    <p:outputLabel value="{gMapsController.selectedPillar.type.pilarType}" />
                </p:row>                          
            </h:panelGrid> 
            
        </p:dialog>  
-->

        <p:dialog widgetVar="dlg" showEffect="fade" closable="false" >

            <addDialog:panelAddDialog/>
             
            <h:inputHidden id="lat" value="#{gMapsController.lat}" />
            <h:inputHidden id="lng" value="#{gMapsController.lng}" />
        </p:dialog>                      
    </h:form>

    <script type="text/javascript">
        var currentMarker = null;
        var map = new google.maps.Map(document.getElementById('gmap'));
 
        function handlePointClick(event) {
            if(currentMarker === null) {
                document.getElementById('lat').value = event.latLng.lat();
                document.getElementById('lng').value = event.latLng.lng();

                currentMarker = new google.maps.Marker({
                    position:new google.maps.LatLng(event.latLng.lat(), event.latLng.lng())
                });

                PF('map').addOverlay(currentMarker);
                PF('dlg').show();
            }   
        }

        function cancel() {
            PF('dlg').hide();
            currentMarker.setMap(null);
            currentMarker = null;

            return false;
        }   
                
    </script>               
    </h:body>
</html>

