<?xml version="1.0" encoding="UTF-8"?>
<!--
To change this license header, choose License Headers in Project Properties.
To change this template file, choose Tools | Templates
and open the template in the editor.
-->
<!DOCTYPE html>
<html   xmlns="http://www.w3.org/1999/xhtml"
        xmlns:h="http://xmlns.jcp.org/jsf/html"
        xmlns:p="http://primefaces.org/ui"
        xmlns:f="http://xmlns.jcp.org/jsf/core"
        xmlns:ez="http://xmlns.jcp.org/jsf/composite/ezcomp"
        xmlns:addDialog="http://xmlns.jcp.org/jsf/composite/ezcomp"
        xmlns:tm="http://xmlns.jcp.org/jsf/composite/ezcomp"
        xmlns:c="http://xmlns.jcp.org/jsp/jstl/core"
        xmlns:ui="http://xmlns.jcp.org/jsf/facelets">
    
    
    <h:head>
        <meta charset="UTF-8" />
	<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"/> 
        
        <link rel="shortcut icon" type="image/png" href="#{request.contextPath}/resources/images/favicon.ico" />
        <title>WP Maps</title>
        <h:outputStylesheet library="css" name="pf_template.css" />
        <h:outputStylesheet library="css" name="info_panel.css" />
        <h:outputStylesheet library="css" name="panel_detail_info.css" />
        
        <script src = "http://maps.google.com/maps/api/js?key=AIzaSyDzwk44zfDh3JQSN1ooK-SIXzvODeFo_dc"
                type = "text/javascript" />
        <style>
            table {
                font-family: "Times New Roman", Times, serif;
                border-collapse: collapse;
                width: 100%;
                
            }

            td, th {
                border: 1px solid #dddddd;
                text-align: left;
                padding: 8px;
                width: 50px;
            }
            .ui-datalist .ui-widget-content
            {
                border-style: none !important
            }
            .gm-style-iw {
                background: #000;
                box-shadow: -14px 0px 0px #000, -14px 9px 0px #000, -14px -8px 0px #000, 15px -8px 0px #000, 15px 9px 0px #000;
                border-radius:4px;
                padding-top: 15px;
              }
            
        </style>        
                
    </h:head>
    <body>
        <h:form id="form" prependId="false" enctype="multipart/form-data" >
        
        <p:growl id="messages" showDetail="true"  sticky="true" />
        <p:gmap id ="gmap" center="#{gMapsController.centerGeoMap}" zoom="#{gMapsController.zoomMap}" type="terrain" model="#{gMapsController.model}"                 
                style="width: 100vw;height: 100vh;" widgetVar="map" fitBounds="false">
            
            <p:ajax event="overlaySelect" listener="#{gMapsController.onMarkerSelect}"  />    
            <p:ajax event="geocode" listener="#{gMapsController.onGeocode}" update="@this" />
            <p:ajax event="reverseGeocode" listener="#{gMapsController.onRevers(event)}" update="@this" />
            <p:ajax event="stateChange" listener="#{gMapsController.onStateChange}"  />
            <!--
            <p:ajax event="stateChange" listener="{gMapsController.onStateChange}" />
            -->
            <p:gmapInfoWindow id="infoWindow" class="map-info-window"  maxWidth="300"> 
                <p:panelGrid id="info_panel_base" style="margin-top:-5px; font: 9pt sans-serif; width: 100%; border: 0px; " styleClass="withOutBorder"> 
                    <p:row>
                        <p:column colspan="5" rowspan="7" style="font-weight: bold;">
                            <p:graphicImage height="150" width="150"  url="https://images.ua.prom.st/596293689_w640_h640_010.jpg"/>
                        </p:column>
                        <p:column rowspan="1" >Тип</p:column> 
                        <p:column rowspan="1" >:</p:column>
                        <p:column rowspan="1" >#{gMapsController.selected_point.decriminatorValue}</p:column>
                    </p:row>

                    <p:row>
                        <p:column rowspan="1" >Владелец</p:column> 
                        <p:column rowspan="1" >:</p:column>
                        <p:column rowspan="1" >#{gMapsController.selected_point.owner != null ? gMapsController.selected_point.owner : '-'}</p:column>
                    </p:row>


                    <p:row>
                        <p:column rowspan="1" >Адрес</p:column> 
                        <p:column rowspan="1" >:</p:column>
                        <p:column rowspan="1" >#{gMapsController.selected_point.address != null ? gMapsController.selected_point.address : '-'}</p:column>
                    </p:row>

                    <p:row>
                        <p:column rowspan="1" >Муфта</p:column> 
                        <p:column rowspan="1" >:</p:column>
                        <p:column rowspan="1" >
                            <h:dataTable value="#{gMapsController.selected_point.clutch}" var="points">
                                <h:column>
                                    <h:commandLink id="false"  onclick="showCabel()" >
                                        <p:outputLabel style="color: white;font: 9pt sans-serif;" value="#{points.mark}"/>                     
                                    </h:commandLink>                                    
                                </h:column>                                                                          
                            </h:dataTable>
                        </p:column>
                    </p:row>   
                    <p:row>
                        <p:column rowspan="1">
                            <p:commandLink  style="color: red;font: 9pt sans-serif;" value="Подробно" action="#{gMapsController.setFlagToTrue()}" onclick="PF('dial').show()" update="toUpdate" />                            
                        </p:column>                        
                    </p:row>                    
                </p:panelGrid>                
            </p:gmapInfoWindow>   
            
        </p:gmap>
            <tm:topMenu/>  
            <tm:user_info/>
            <p:dialog widgetVar="dial" style="background: black;" resizable="no" width="700" height="300">
            <p:outputPanel id="toUpdate" style="width: 660px; background: black;">
                <p:panel id="myPanel" rendered="#{gMapsController.flag}" widgetVar="ww" toggleable="true" closable="true" toggleSpeed="500" closeSpeed="500">
                    <h:panelGrid style="margin-top:-5px; font: 9pt sans-serif; width: 100%; " rendered="#{gMapsController.selected_point.decriminatorValue == 'Дом'}">
                                <f:facet name="header">
                                <p:row>
                                    <p:column colspan="12">Объект</p:column>
                                </p:row>
                                <p:row>
                                    <p:column colspan="2">Тип</p:column>
                                    <p:column colspan="2">Кол. кассет</p:column>
                                    <p:column colspan="2">Состояние</p:column>
                                    <p:column colspan="2">Кол. вводов</p:column>
                                    <p:column colspan="2">Маркировка</p:column>
                                    <p:column colspan="2">Информация</p:column>            
                                </p:row>

                            </f:facet>
                                <p:row>
                                    <p:column rowspan="1" colspan="2">#{gMapsController.selected_point.decriminatorValue}</p:column>
                                    <p:column rowspan="1" colspan="2">#{gMapsController.selecte}</p:column>
                                    <p:column rowspan="1" colspan="2">#</p:column>
                                    <p:column rowspan="1" colspan="2">#</p:column>
                                    <p:column rowspan="1" colspan="2">#</p:column>
                                    <p:column rowspan="1" colspan="2">#</p:column> 
                                </p:row> 
                    </h:panelGrid>
                        <p:panelGrid  style="margin-top:-5px; font: 9pt sans-serif; width: 100%; " rendered="#{gMapsController.selected_point.decriminatorValue == 'Столб'}">  
                                <f:facet name="header">
                                <p:row>
                                    <p:column colspan="14">Объект</p:column>
                                </p:row>
                                <p:row>
                                    <p:column colspan="1">Тип</p:column>
                                    <p:column colspan="2">Балансодержатель опоры</p:column>
                                    <p:column colspan="2">Трансформаторная подстанция</p:column>
                                    <p:column colspan="2">Фидр</p:column>
                                    <p:column colspan="2">Номер опоры</p:column>
                                    <p:column colspan="2">Материал опоры</p:column>   
                                    <p:column colspan="2">Форма опоры:</p:column>                                    
                                </p:row>

                            </f:facet>
                                <p:row>
                                    <p:column rowspan="1" colspan="1">#{gMapsController.selected_point.decriminatorValue}</p:column>
                                    <p:column rowspan="1" colspan="2">#{gMapsController.selected_point.owner}</p:column>
                                    <p:column rowspan="1" colspan="2">#{gMapsController.selected_point.transportStation}</p:column>
                                    <p:column rowspan="1" colspan="2">#{gMapsController.selected_point.id}</p:column>
                                    <p:column rowspan="1" colspan="2">#{gMapsController.selected_point.numberStation}</p:column>
                                    <p:column rowspan="1" colspan="2">#{gMapsController.selected_point.toString().substring(gMapsController.selected_point.toString().indexOf('material=')+9,gMapsController.selected_point.toString().indexOf('type=')-3)}</p:column> 
                                    <p:column rowspan="1" colspan="2">#{gMapsController.selected_point.toString().substring(gMapsController.selected_point.toString().indexOf('form=')+5,gMapsController.selected_point.toString().indexOf('clutch')-13)}</p:column>                                                                        
                                </p:row> 
                        <p:row style="padding-top: 20px;">
                                <p:column colspan="1">Примечание</p:column>           
                        </p:row>                             
                        </p:panelGrid>

                        <p:panelGrid  style="margin-top:-5px; font: 9pt sans-serif; width: 100%; " rendered="#{gMapsController.selected_point.decriminatorValue == 'Колодец'}">  
                            <f:facet name="header">
                                <p:row>
                                    <p:column colspan="8">Объект</p:column>
                                </p:row>
                                <p:row>
                                    <p:column colspan="2">Тип</p:column>
                                    <p:column colspan="2">№ колодца</p:column>
                                    <p:column colspan="2">№ канала:</p:column>
                                    <p:column colspan="2">Приямок:</p:column>
            
                                </p:row>

                            </f:facet>
                                <p:row>
                                    <p:column rowspan="1" colspan="2">#{gMapsController.selected_point.decriminatorValue}</p:column>
                                    <p:column rowspan="1" colspan="2">#{gMapsController.selected_point.toString().substring(gMapsController.selected_point.toString().indexOf('number=')+7,gMapsController.selected_point.toString().indexOf('}'))} </p:column>
                                    <p:column rowspan="1" colspan="2">#{gMapsController.selected_point.numberStation}</p:column> 
                                    <p:column rowspan="1" colspan="2">#{gMapsController.selected_point.toString().substring(gMapsController.selected_point.toString().indexOf('pit=')+4,gMapsController.selected_point.toString().indexOf('chanel')-2)}</p:column>
                                </p:row>                                              
                        </p:panelGrid>                 
                   
                    <p:panelGrid  style="margin-top:-5px; font: 9pt sans-serif; width: 100%; " >  
                            <f:facet name="header">
                            <p:row>
                                <p:column colspan="12">Муфта</p:column>
                            </p:row>
                            <p:row>
                                <p:column colspan="2">#</p:column>
                                <p:column colspan="2">Кол. кассет</p:column>
                                <p:column colspan="2">Состояние</p:column>
                                <p:column colspan="2">Кол. вводов</p:column>
                                <p:column colspan="2">Маркировка</p:column>
                                <p:column colspan="2">Информация</p:column>            
                            </p:row>

                        </f:facet>
                            <p:dataList value="#{gMapsController.selected_point.clutch}" rowIndexVar="rowIndex" var="cl" type="definition" >
                                <p:row>
                                    <p:column rowspan="1" colspan="2">#{rowIndex+1}</p:column>
                                    <p:column rowspan="1" colspan="2">#{cl.cassetsCount}</p:column>
                                    <p:column rowspan="1" colspan="2">#{cl.conditions}</p:column>
                                    <p:column rowspan="1" colspan="2">#{cl.inputs}</p:column>
                                    <p:column rowspan="1" colspan="2">#{cl.mark }</p:column>
                                    <p:column rowspan="1" colspan="2">#{cl.info }</p:column> 
                                </p:row>                                              
                            </p:dataList>
                                              
                    </p:panelGrid>    
                </p:panel>
            </p:outputPanel>             
        </p:dialog>
        <p:panel id="legend_panel" styleClass="legendPanel" visible="false" widgetVar="testPanel" closable="true" toggleable="true" >            
            <table style=" font: 8pt sans-serif; width: 17vw; background: red; " >
                <tr class="noBorder">                    
                    <td>Дом:</td>
                    <td><p:graphicImage height="27" width="27" value="../resources/marker/Дом_marker.png"  title="Дом/House"/></td>
                    <td>Колодец:</td>
                    <td><p:graphicImage height="27" width="27" value="../resources/marker/Колодец_marker.png" /></td>
                    <td>Столб:</td>
                    <td><p:graphicImage height="27" width="27" value="../resources/marker/Столб_marker.png" /></td>
                </tr>                  
            </table>  
        </p:panel>
        <p:panel id="search_panel" widgetVar="search_pan"  visible="false" >
            <h:panelGrid styleClass="searchPanel" columns="3" style="margin-bottom:10px" cellpadding="5">
                <p:inputText id="address" />
                <p:commandButton  icon="ui-icon-search" onclick="geocode()" type="button" />
            </h:panelGrid>            
        </p:panel>            
            <!--
        <p:dialog header="Modal Dialog" widgetVar="passwordIn" modal="true" height="100">
            <p:inputText value="{topMenuController.password}"/>
            <p:commandButton value="Save Edits"  /> 
        </p:dialog>
            -->            
        </h:form>
    <script type="text/javascript">
        var currentMarker = null;
        var map = new google.maps.Map(document.getElementById('gmap'));
        var wind = null;
               
        function geocode() {
            PF('map').geocode(document.getElementById('address').value);
        }
        
        function openHistory(){
            var query = $('#legend_panel');
            var isVisible = query.is(':visible');
            if(isVisible === true){
              PF('testPanel').close();
            }else{
              PF('testPanel').show(); 
            }
            
        }
        function openSearch(){
            var query = $('#search_panel');
            var isVisible = query.is(':visible');
            if(isVisible === true){
              PF('search_pan').close();
            }else{
              PF('search_pan').show(); 
            }
            
        }  
    
    </script>        
    </body>
</html>
